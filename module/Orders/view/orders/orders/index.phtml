<?php $this->inlineScript()->captureStart(); ?>
$("#datatable").on("fnServerData", function(event, sSource, aoData, fnCallback, oSettings) {
    $("#filters input[name], #filters select[name]").each(function() {
        aoData.push({"name": "filter[" + $(this).attr("name") + "]", "value": $(this).val()});
    });
    aoData.push({"name": "batch", "value": $('#hidden_batch_filter').val()});
});

$("#filters input[name='apply-filters']").on("click", function() {
    $("#datatable").cgDataTable("redraw");
});

$("#filters input[name='clear-filters']").on("click", function() {
    $("#filters input[name][type!='button'], #filters select[name]").val(undefined);
    $("#datatable").cgDataTable("redraw");
});

function batchFilter(batchId) {
    $('#hidden_batch_filter').val(batchId);
    $("#filters input[name='clear-filters']").click();
}

var templateUrl = '<?= $this->basePath() . Orders\Module::PUBLIC_FOLDER . 'template/row.html' ?>';
var templateRowId = 'order-row';
CGMustache.get().fetchTemplate(templateUrl, function(template, cgmustache)
{
    $("#datatable").on("fnRowCallback", function (event, nRow, aData, iDisplayIndex, iDisplayIndexFull)
    {
        aData.formatCurrency = cgmustache.formatCurrency(aData);
        aData.formatDateTime = cgmustache.formatDateTime(aData);
        aData.formatAdditionalOrderItems = function()
        {
            return function(variable, render) {
                aData.extraItems = JSON.parse(JSON.stringify(aData.items));
                aData.extraItems.splice(0, 1);
                return render(variable);
            };
        };

        var html = cgmustache.renderTemplate(template, aData, templateRowId);
        $(nRow).html(html);
    });
});
<?php $this->inlineScript()->captureEnd(); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/mustache.js'); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/cg-mustache.js'); ?>
<?php $this->placeholder('#main.class')->append('full-width'); ?>
<?php $this->placeholder('#sub-header')->append($this->filters); ?>
<?php $this->placeholder('#sidebar')->set($this->sidebar); ?>
<?= $this->bulkItems; ?>
<?= $this->ordersTable; ?>