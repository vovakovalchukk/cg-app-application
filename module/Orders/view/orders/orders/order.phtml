<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/mustache.js'); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/cg-mustache.js'); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/notifications.js'); ?>
<?php $this->inlineScript()->captureStart(); ?>
    function saveAlert() {
        clearNotification('<?= $this->translate('Saving alert'); ?>');
        var alert = $('#alert-input').val();
        var action = alert ? 'set' : 'delete';
        $.ajax({
            url: '<?= $this->url('Orders/order/alert', array('order' => $order->getId())); ?>/' + action,
            type: 'POST',
            data: {'alert': alert, 'eTag': $('#alert-etag').val()},
            dataType : 'json',
            success: function(data) {
                $('#alert-etag').val(data.eTag);
                successNotification('<?= $this->translate('Alert saved'); ?>');
            },
            error: function (error, textStatus, errorThrown) {
                return that.getNotification().ajaxErrorNotification(error, textStatus, errorThrown);
            }
        });
    }
    $('form').submit(function() {
        return false;
    });
<?php $this->inlineScript()->captureEnd(); ?>
<?php $this->placeholder('#sidebar')->set($this->sidebar); ?>
<div id="order-status" class="<?= $order->getStatus(); ?>-bg"><?= $order->getStatus(); ?></div>
<div id="breadcrumbs" class="order-breadcrumbs">
    <ul>
        <li><a href="#"><?= $this->translate('View Order'); ?></a></li>
        <li class="separator"><span>&nbsp;</span></li>
        <li><span><?= $order->getId(); ?></span></li>
    </ul>
    <div class="right">
        <span><strong><?= $this->translate('Order ID'); ?>: </strong><?= $order->getId(); ?></span>
        <img src="<?= $this->basePath() . CG_UI\Module::PUBLIC_FOLDER; ?>/img/logos/<?= $order->getChannel(); ?>.png" alt="<?= $order->getChannel(); ?>" />
    </div>
</div>
<?= $this->bulkItems ?>
<?= $this->timelineBoxes; ?>
<div class="module clearfix">
    <form class="single-row">
        <label>
            <span class="icon-large warning"></span>
            <span class="label"><?= $this->translate('Order Alert'); ?>:</span>
            <?php
                $alerts = $order->getAlerts();
                $alerts->rewind();
                $alert = $alerts->current();
            ?>
            <input type="text" class="text" name="" value="<?= ($alert) ? $alert->getAlert() : ""; ?>" id="alert-input"/>
            <input type="hidden" value="<?= ($alert) ? $alert->getETag() : ""; ?>" id="alert-etag"/>
            <input type="submit" class="button inline" value="<?= $this->translate('Save Alert'); ?>" onClick="saveAlert();" />
        </label>
    </form>
</div>
<div class="module clearfix">
    <form class="single-row">
        <label>
            <span class="icon-large user"></span>
            <p><?= $order->getBuyerMessage() ?: $this->translate("There is no buyer message for this order"); ?></p>
        </label>
    </form>
</div>
<div class="module clearfix">
    <div id="detailsForm">
        <form id="addressInformation" data-url="<?= $this->url('Orders/order/address', array('order' => $order->getId())); ?>"
              data-actionMessage="<?= $this->translate('Updating address'); ?>" data-successMessage="<?= $this->translate('Address updated'); ?>">
            <input type="hidden" id="eTag" name="eTag" value="<?= $order->getUserChange() ? $order->getUserChange()->getEtag() : null; ?>">
            <div class="half" id="billing-information">
                <h2><?= $this->translate('Billing Information'); ?></h2>
                <label>
                    <span><?= $this->translate('Buyer Name'); ?></span>
                    <input type="text" name="billingAddressFullName" value="<?= $order->getBillingAddress()->getAddressFullName(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Company Name'); ?></span>
                    <input type="text" name="billingAddressCompanyName" value="<?= $order->getBillingAddress()->getAddressCompanyName(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 1'); ?></span>
                    <input type="text" name="billingAddress1" value="<?= $order->getBillingAddress()->getAddress1(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 2'); ?></span>
                    <input type="text" name="billingAddress2" value="<?= $order->getBillingAddress()->getAddress2(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 3'); ?></span>
                    <input type="text" name="billingAddress3" value="<?= $order->getBillingAddress()->getAddress3(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('City'); ?></span>
                    <input type="text" name="billingAddressCity" value="<?= $order->getBillingAddress()->getAddressCity(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('County'); ?></span>
                    <input type="text" name="billingAddressCounty" value="<?= $order->getBillingAddress()->getAddressCounty(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Postcode'); ?></span>
                    <input type="text" name="billingAddressPostcode" value="<?= $order->getBillingAddress()->getAddressPostCode(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Country'); ?></span>
                    <input type="text" name="billingAddressCountry" value="<?= $order->getBillingAddress()->getAddressCountry(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Email'); ?></span>
                    <input type="text" name="billingEmailAddress" value="<?= $order->getBillingAddress()->getEmailAddress(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Telephone'); ?></span>
                    <input type="text" name="billingPhoneNumber" value="<?= $order->getBillingAddress()->getPhoneNumber(); ?>">
                </label>
            </div>
            <div class="half"  id="shipping-information">
                <h2><?= $this->translate('Shipping Information'); ?></h2>
                <label>
                    <span><?= $this->translate('Recipient Name'); ?></span>
                    <input type="text" name="shippingAddressFullName" value="<?= $order->getShippingAddress()->getAddressFullName(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Company Name'); ?></span>
                    <input type="text" name="shippingAddressCompanyName" value="<?= $order->getShippingAddress()->getAddressCompanyName(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 1'); ?></span>
                    <input type="text" name="shippingAddress1" value="<?= $order->getShippingAddress()->getAddress1(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 2'); ?></span>
                    <input type="text" name="shippingAddress2" value="<?= $order->getShippingAddress()->getAddress2(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Address Line 3'); ?></span>
                    <input type="text" name="shippingAddress3" value="<?= $order->getShippingAddress()->getAddress3(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('City'); ?></span>
                    <input type="text" name="shippingAddressCity" value="<?= $order->getShippingAddress()->getAddressCity(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('County'); ?></span>
                    <input type="text" name="shippingAddressCounty" value="<?= $order->getShippingAddress()->getAddressCounty(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Postcode'); ?></span>
                    <input type="text" name="shippingAddressPostcode" value="<?= $order->getShippingAddress()->getAddressPostCode(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Country'); ?></span>
                    <input type="text" name="shippingAddressCountry" value="<?= $order->getShippingAddress()->getAddressCountry(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Email'); ?></span>
                    <input type="text" name="shippingEmailAddress" value="<?= $order->getShippingAddress()->getEmailAddress(); ?>">
                </label>
                <label>
                    <span><?= $this->translate('Telephone'); ?></span>
                    <input type="text" name="shippingPhoneNumber" value="<?= $order->getShippingAddress()->getPhoneNumber(); ?>">
                </label>
            </div>
            <div class="half" style="clear:both; padding-top:0px;">
                <label>
                    <input type="submit" name="save" class="button form-button address-button" value="<?= $this->translate('Save'); ?>">
                </label>
            </div>
        </form>
    </div>
</div>
<div class="module clearfix">
    <h2><?= $this->translate('Product & Payment Information'); ?></h2>
    <?php if(count($order->getItems())):?>
        <?= $this->productPaymentTable; ?>
    <?php else: ?>
        <p><?= $this->translate('This order has no items'); ?></p>
    <?php endif;?>
    <table class="no-borders">
        <tr>
            <td colspan="2"><?= $this->translate('Paid Via'); ?>: <strong><?= $order->getPaymentMethod() ?></strong></td>
            <td class="right"><strong><?= $this->translate('Postage'); ?>:</strong></td>
            <td class="right"><strong><?= $this->currencyFormat($order->getShippingPrice()); ?></strong></td>
        </tr>
        <tr>
            <td colspan="2"><?= $this->translate('Reference'); ?>: <strong><?= $order->getPaymentReference() ?></strong></td>
            <td class="right"><strong><?= $this->translate('Total'); ?>:</strong></td>
            <td class="right"><strong><?= $this->currencyFormat($order->getTotal()); ?></strong></td>
        </tr>
    </table>
    <form  method="post" class="ajaxPost">
        <label>
            <span>Refund Amount &pound;</span>
            <input type="text" name="companyName" required="required" placeholder="" value="">
        </label>
        <label>
            <span>Refund Reason</span>
            <div class="input">
                <div class="custom-select">
                    <div class="selected">Select <span class="arrow down">&nbsp;</span></div>
                    <ul>
                        <li><a href="#">Some reason</a></li>
                        <li><a href="#">Another reason</a></li>
                        <li><a href="#">And Another Reason</a></li>
                    </ul>
                </div>
            </div>
        </label>
        <label>
            <input type="submit" name="save" class="button form-button" value="Refund">
            <span class="loading">Refunding</span>
        </label>
    </form>
</div>
<div class="module clearfix">
    <h2>Shipping</h2>
    <form  method="post" class="ajaxPost">
        <label>
            <span>Shipping Service</span>
            <div class="input">
                <?php
                $data =  array(
                    'options' =>array(
                        array('img' => $this->basePath() . CG_UI\Module::PUBLIC_FOLDER . '/img/logos/royalmail.png', 'href' => '#', 'title' => 'Royal Mail', 'class' => ''),
                        array('img' => $this->basePath() . CG_UI\Module::PUBLIC_FOLDER . '/img/logos/dpd.png', 'href' => '#', 'title' => 'DPD',  'class' => ''),
                        array('img' => $this->basePath() . CG_UI\Module::PUBLIC_FOLDER . '/img/logos/interlink.png', 'href' => '#', 'title' => 'Interlink', 'class' => ''),
                        array('img' => $this->basePath() . CG_UI\Module::PUBLIC_FOLDER . '/img/logos/parcelforce.png', 'href' => '#', 'title' => 'Parcel Force', 'class' => '')
                    ),
                    'customSelectImgSrc' => $this->basePath() . CG_UI\Module::PUBLIC_FOLDER . '/img/logos/royalmail.png'
                );
                ?>
                <?= $this->partial('elements/custom-select-image', $data); ?>
                <?php // include('includes/layout/custom/custom-select-image.php'); ?>
            </div>
        </label>
        <label>
            <span>Tracking Number</span>
            <input type="text" name="companyName" required="required" placeholder="My Company Ltd"  value="GB 1234567890">
        </label>
    </form>
</div>
<?= $this->notes ?>