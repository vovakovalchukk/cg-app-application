<?php $this->inlineScript()->captureStart(); ?>
var datatable = $("#datatable");

datatable.on("redraw", function() {
    datatable.removeData("filterId");
});

datatable.on("fnServerData", function(event, sSource, aoData, fnCallback, oSettings) {
    var filterId = datatable.data("filterId");
    if (filterId) {
        return;
    }

    $("#filters :input[name]").each(function() {
        var value = $.trim($(this).val());
        if (!value.length) {
            return;
        }
        var name = $(this).attr("name").replace(/^(.*?)(\[.*\])?$/g, "filter[$1]$2");

        aoData.push({
            "name": name,
            "value": value
        });
    });

    aoData.push({"name": "filter[batch]", "value": $('#hidden_batch_filter').val()});
});

datatable.on("jqXHRBeforeSend", function(event, request, settings) {
    var filterId = datatable.data("filterId");
    if (filterId) {
        settings.url += "/" + filterId;
    }

    request.done(function(data, status, request) {
        if (!data.sFilterId) {
            return;
        }

        $(event.target).data("filterId", data.sFilterId);
    });
});

datatable.on("fnRowCallback", function(event, nRow, aData, iDisplayIndex, iDisplayIndexFull) {
    $("a.title", nRow).cgPjax();
});

require([
    "order/OrderPage"
],
function(OrderPage) {
    var orderPage = new OrderPage();
});
require.config({
    paths: {
        'Filters': "<?= $this->basePath() . Orders\Module::PUBLIC_FOLDER . 'js';?>"
    }
});
require(["Filters/FilterCollection"], function(filterCollection) {
    var filterNames = {
<?php
    foreach ($filterNames as $index => $filterName) {
        echo $filterName . ": '" . $filterName . "', ";
    }
?>
    };
    filterCollection.setFilters(filterNames);
});
<?php $this->inlineScript()->captureEnd(); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/mustache.js'); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/cg-mustache.js'); ?>
<?php $this->headScript()->appendFile($this->basePath() . CG_UI\Module::PUBLIC_FOLDER . 'js/jqueryPlugin/cg-pjax.js'); ?>
<?php $this->placeholder('#main.class')->append('full-width'); ?>
<?php
$this->placeholder('#sidebar')
    ->append($this->statusFiltersSidebar)
    ->append($this->storedFiltersSidebar)
    ->append($this->batches);
?>
<?php $this->headLink()->appendStylesheet($this->basePath() . Orders\Module::PUBLIC_FOLDER . 'css/orders.css') ?>
<div id="main" class="transition-preload module clearfix<?= $this->placeholder('#main.class')->setPrefix(' ')->setIndent(1) ?>">
    
<?= $this->breadcrumbs; ?>
<?= $this->bulkItems; ?>
<div class="products-list">
    <?= $this->products; ?>
</div>
</div>
